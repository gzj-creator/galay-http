# T11-HTTP 路由器测试

## 测试概述

本文档记录 HttpRouter 路由器功能的单元测试结果。测试覆盖了路由匹配、路径参数提取、通配符匹配、优先级匹配等核心功能。

## 测试目标

验证 `HttpRouter` 类的路由功能，确保能够正确处理：
- 精确路径匹配
- 路径参数提取（`:param`）
- 单段通配符匹配（`*`）
- 贪婪通配符匹配（`**`）
- 多 HTTP 方法支持
- 路由优先级（精确 > 参数 > 通配符）
- 路由管理操作（添加、删除、清空）

## 测试场景

### 1. 精确匹配测试

#### 1.1 基本精确匹配
- **测试内容**：注册精确路径路由（`/api/users`、`/api/posts`）
- **验证点**：
  - GET `/api/users` 匹配成功
  - POST `/api/users` 匹配成功
  - GET `/api/posts` 匹配成功
  - GET `/api/comments` 不匹配（未注册）
  - DELETE `/api/users` 不匹配（方法不匹配）

### 2. 路径参数测试

#### 2.1 单个参数提取
- **测试内容**：注册带参数路由 `/user/:id`
- **验证点**：
  - `/user/123` 匹配成功，提取 `id=123`
  - `/user/abc` 匹配成功，提取 `id=abc`
  - `/user` 不匹配（缺少参数）

#### 2.2 多个参数提取
- **测试内容**：注册 `/user/:id/posts/:postId`
- **验证点**：
  - `/user/456/posts/789` 匹配成功
  - 正确提取 `id=456` 和 `postId=789`
  - `/user/123/posts` 不匹配（参数不完整）

### 3. 通配符匹配测试

#### 3.1 单段通配符（`*`）
- **测试内容**：注册 `/static/*`
- **验证点**：
  - `/static/css` 匹配成功
  - `/static/js` 匹配成功
  - `/static/css/style.css` 不匹配（多段路径）

#### 3.2 贪婪通配符（`**`）
- **测试内容**：注册 `/files/**`
- **验证点**：
  - `/files/a` 匹配成功
  - `/files/a/b/c` 匹配成功（多段路径）

### 4. 多 HTTP 方法测试

#### 4.1 同路径多方法
- **测试内容**：为 `/api/resource` 注册 GET、POST、PUT 方法
- **验证点**：
  - GET、POST、PUT 请求均匹配成功
  - DELETE 请求不匹配（未注册）

### 5. 优先级匹配测试

#### 5.1 匹配优先级
- **测试内容**：同时注册精确、参数、通配符路由
  - `/api/users`（精确）
  - `/api/:resource`（参数）
  - `/api/*`（通配符）
- **验证点**：
  - `/api/users` 匹配精确路由（最高优先级）
  - `/api/posts` 匹配参数路由，提取 `resource=posts`

### 6. 路由管理操作测试

#### 6.1 路由计数
- **测试内容**：测试 `size()` 方法
- **验证点**：
  - 初始大小为 0
  - 添加 3 个路由后大小为 3

#### 6.2 删除路由
- **测试内容**：测试 `delHandler()` 方法
- **验证点**：
  - 删除成功返回 true
  - 路由数量减少
  - 删除后路由不再匹配

#### 6.3 清空路由
- **测试内容**：测试 `clear()` 方法
- **验证点**：
  - 清空后大小为 0
  - 所有路由不再匹配

### 7. 边界情况测试

#### 7.1 根路径
- **测试内容**：注册根路径 `/`
- **验证点**：根路径匹配成功

#### 7.2 尾部斜杠
- **测试内容**：注册 `/api/users/`
- **验证点**：带尾部斜杠的路径匹配成功

#### 7.3 多重斜杠
- **测试内容**：请求 `//api//users//`
- **验证点**：空段被正确处理

## 测试用例列表

| 编号 | 测试用例 | 类型 | 预期结果 |
|------|---------|------|---------|
| 1 | 精确匹配 | Exact | ✓ 匹配成功 |
| 2 | 单个路径参数 | Parameter | ✓ 参数提取正确 |
| 3 | 多个路径参数 | Parameter | ✓ 多参数提取正确 |
| 4 | 单段通配符 | Wildcard | ✓ 单段匹配成功 |
| 5 | 贪婪通配符 | Wildcard | ✓ 多段匹配成功 |
| 6 | 多 HTTP 方法 | Method | ✓ 多方法支持 |
| 7 | 优先级匹配 | Priority | ✓ 优先级正确 |
| 8 | 路由计数 | Management | ✓ 计数正确 |
| 9 | 删除路由 | Management | ✓ 删除成功 |
| 10 | 清空路由 | Management | ✓ 清空成功 |
| 11 | 根路径 | Edge | ✓ 根路径匹配 |
| 12 | 尾部斜杠 | Edge | ✓ 斜杠处理正确 |
| 13 | 多重斜杠 | Edge | ✓ 空段处理正确 |

## 测试代码位置

- **文件路径**：`/Users/gongzhijie/Desktop/projects/git/galay-http/test/T11-HttpRouter.cc`
- **测试函数数量**：7 个
- **代码行数**：307 行

## 运行测试

### 编译测试

```bash
cd build
cmake ..
make T11-HttpRouter
```

### 运行测试

```bash
./test/T11-HttpRouter
```

### 预期输出

```
========================================
HttpRouter Unit Tests
========================================

========================================
Test 1: Exact Match
========================================
✓ GET /api/users matched
✓ POST /api/users matched
✓ GET /api/posts matched
✓ GET /api/comments not matched (expected)
✓ DELETE /api/users not matched (expected)
✓ All exact match tests passed

========================================
Test 2: Path Parameters
========================================
✓ GET /user/123 matched, id=123
✓ GET /user/abc matched, id=abc
✓ GET /user/456/posts/789 matched, id=456, postId=789
✓ GET /user not matched (expected)
✓ GET /user/123/posts not matched (expected)
✓ All path parameter tests passed

...

========================================
✓ ALL TESTS PASSED!
========================================
```

## 测试结论

### 功能验证

✅ **精确匹配功能完善**：支持精确路径匹配和方法区分
✅ **路径参数提取正确**：支持单个和多个参数提取
✅ **通配符匹配灵活**：支持单段和贪婪通配符
✅ **优先级机制合理**：精确 > 参数 > 通配符
✅ **路由管理完整**：支持添加、删除、清空操作
✅ **边界情况处理良好**：正确处理根路径、斜杠等特殊情况

### 性能特点

- **高效查找**：基于 Trie 树结构，查找时间复杂度 O(n)，n 为路径段数
- **内存优化**：共享路径前缀，节省内存
- **灵活扩展**：支持自定义处理器和中间件

### 适用场景

1. **RESTful API**：完美支持 REST 风格的路由设计
2. **微服务网关**：可作为请求路由分发器
3. **Web 框架**：作为 HTTP 框架的核心路由组件

### 已知限制

- 路径参数不支持正则表达式验证
- 不支持路由分组和中间件链
- 通配符必须在路径末尾

---

**测试日期**：2026-01-29
**测试人员**：galay-http 开发团队
**文档版本**：v1.0
